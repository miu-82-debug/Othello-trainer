<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>リバーシ定石トレーナー（PWA）</title>
  <link rel="manifest" href="manifest.webmanifest">
  <meta name="theme-color" content="#222222">
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <header class="app-header">
    <h1>リバーシ定石トレーナー</h1>
    <button id="installBtn" hidden>ホーム画面に追加</button>
  </header>

  <main class="layout">
    <aside class="sidebar">
      <div class="loader">
        <details open>
          <summary>データの読み込み</summary>
          <div class="load-controls">
            <button id="loadBundledBtn">内蔵データを読み込む</button>
            <div class="or">または</div>
            <label class="file-btn">
              JSONファイルを選ぶ
              <input id="fileInput" type="file" accept="application/json">
            </label>
            <p class="hint">
              ※最初は「内蔵データ」を読み込むのが簡単です。データを差し替える場合は、JSONを選択してください。
            </p>
          </div>
        </details>
      </div>

      <div class="filters">
        <input id="searchBox" type="search" placeholder="名前・コメントで検索…" />
      </div>

      <nav class="tree">
        <h3>フォルダ</h3>
        <ul id="bigList"></ul>
      </nav>
      <nav class="tree">
        <h3>サブフォルダ</h3>
        <ul id="smallList"></ul>
      </nav>
      <nav class="tree">
        <h3>棋譜（定石）</h3>
        <ul id="kifuList"></ul>
      </nav>
    </aside>

    <section class="content">
      <div class="board-panel">
        <div class="board-wrap">
          <div id="board" class="board" aria-label="リバーシ盤 8x8"></div>
        </div>
        <div class="controls">
          <button id="firstBtn" title="最初">&laquo;</button>
          <button id="prevBtn" title="戻る">&lsaquo;</button>
          <span id="moveInfo">0 / 0</span>
          <button id="nextBtn" title="進む">&rsaquo;</button>
          <button id="lastBtn" title="最後">&raquo;</button>
          <button id="autoBtn" title="自動再生">自動</button>
        </div>
      </div>

      <article class="meta">
        <h2 id="kifuTitle">定石を選んでください</h2>
        <div id="kifuMeta"></div>
        <details>
          <summary>現在の手順</summary>
          <ol id="moveList"></ol>
        </details>
      </article>
    </section>
  </main>

  <footer class="app-footer">
    <small>オフライン対応（PWA）。このアプリはあなたのJSONデータをローカルで読み込みます。</small>
  </footer>

  <script defer src="app.js"></script>
  <script>
    // PWA install prompt
    let deferredPrompt;
    const installBtn = document.getElementById('installBtn');
    window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault();
      deferredPrompt = e;
      installBtn.hidden = false;
    });
    installBtn?.addEventListener('click', async () => {
      installBtn.hidden = true;
      if (deferredPrompt) {
        deferredPrompt.prompt();
        await deferredPrompt.userChoice;
        deferredPrompt = null;
      }
    });

    // Register service worker
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('./service-worker.js').catch(console.warn);
      });
    }
  </script>
</body>
</html>
